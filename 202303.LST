10 DIMIN$(3)
20 OPEN 1,8,0,"2023031.TXT,P,R"     : REM read input data
30 GOSUB 250
40 GOSUB 250
50 IN$(1) = RPT$(ASC("."),LEN(IN$(2)))
60 FORX=1 TO LEN(IN$(2))
70 X$=MID$(IN$(2),X,1)
80 IF ASC("0") <= ASC(X$) AND ASC(X$) <= ASC("9") THEN XS=X:XM=X:N=0:GOSUB 130
90 NEXT X
100 IFETHEN CLOSE1:END
110 GOSUB250
120 GOTO 60
130 N = N+ASC(X$) - ASC("0")
140 X = X+1
150 X$=MID$(IN$(2),X,1)
160 IF ASC("0") <= ASC(X$) AND ASC(X$) <= ASC("9") THEN N = N*10:XM=X:  GOTO 130
170 FOR X1=XS-1 TO XM+1
180 IF MID$(IN$(1),X1,1)<>"." THEN SP = SP+N
190 IF MID$(IN$(3),X1,1)<>"." THEN SP = SP+N
200 NEXT X1
210 IF MID$(IN$(2),XS-1,1)<>"." THEN SP = SP+N
220 IF MID$(IN$(2),XM+1,1)<>"." THEN SP = SP+N
230 PRINTN, SP
240 RETURN
250 IN$(1)=IN$(2)
260 IN$(2)=IN$(3)
270 IF ST<64 THEN LINPUT#1,IN$(3): IN$(3) = "."+IN$(3)+".": RETURN
280 IN$(3) =RPT$(ASC("."),LEN(IN$(2)))
290 E=1
300 RETURN





10 TS=TI: GM%=$03
20 DIM IN$(3): DIM G%(255,GM%): L=-1
30 OPEN 1,8,0,"2023031.TXT,P,R"
40 GOSUB 380
50 GOSUB 380
60 D=ASC("."): IN$(1) = RPT$(D,LEN(IN$(2)))
70 PRINTL-1;">"+LEFT$(IN$(1),75)
71 PRINTL  ;">"+LEFT$(IN$(2),75)
72 PRINTL+1;">"+LEFT$(IN$(3),75)
75 FORX=1 TO LEN(IN$(2))
80 X$=MID$(IN$(2),X,1)
90 IF ASC("0") <= ASC(X$) AND ASC(X$) <= ASC("9") THEN XS=X:XM=X:N=0:GOSUB 140
100 NEXT X
110 IFETHEN : PRINT "Completed in";(TI-TS)/60;"s":  CLOSE1:END
115 PRINTL-1;"*";:FORXX=1TO20:PRINTG%(XX,(L-1)ANDGM%);:NEXT:PRINT
116 PRINTL  ;"*";:FORXX=1TO20:PRINTG%(XX,(L+0)ANDGM%);:NEXT:PRINT
117 PRINTL+1;"*";:FORXX=1TO20:PRINTG%(XX,(L+1)ANDGM%);:NEXT:PRINT
120 GOSUB380
130 GOTO 70
140 N = N+ASC(X$) - ASC("0")
150 X = X+1
160 X$=MID$(IN$(2),X,1)
170 IF ASC("0") <= ASC(X$) AND ASC(X$) <= ASC("9") THEN N = N*10:XM=X:GOTO 140
180 REM //
190 REM // Find symbols in row up XU$ and down XD$
200 FOR X1=XS-1 TO XM+1
210 XU$=MID$(IN$(1),X1,1)
220 XD$=MID$(IN$(3),X1,1)
230 IF XU$<>"." OR XD$<>"." THEN SP = SP+N
240 IFXU$="*" THENGX=X1:GY=L-1:GOSUB 470
250 IFXD$="*" THENGX=X1:GY=L+1:GOSUB 470
260 NEXT X1
270 REM //
280 REM // Find symbols left XL$ and right XR$
290 XL$=MID$(IN$(2),XS-1,1)
300 XR$=MID$(IN$(2),XM+1,1)
310 IF XL$<>"." OR XR$<>"." THEN SP = SP+N
320 IFXL$="*" THENGX=XS-1:GY=L:GOSUB 470
330 IFXR$="*" THENGX=XM+1:GY=L:GOSUB 470
340 PRINTL,L AND GM%,   XS,XM,N, SP
350 RETURN
360 REM --------
370 REM -- Shift IN$ up and read to EOF
380 L=L+1
390 FORI=0 TO255: G%( I, (L+1) AND GM%) = 0:NEXTI
400 REMG%( I, (L+2) AND $3F) = 0
410 REMG%( I, (L+3) AND $3F) = 0: NEXTI
420 IN$(1)=IN$(2)
430 IN$(2)=IN$(3)
440 IF ST<64 THEN LINPUT#1,IN$(3): IN$(3) = "."+IN$(3)+".": RETURN
450 E=1:IN$(3) =RPT$(ASC("."),LEN(IN$(2)))
460 RETURN
470 REM --------
480 REM -- Process Gears (GX, GY, N)
490 PRINT"*(";GX";"GY"):"N
500 GG% =G%( GX, GY AND GM%)
510 IF GG% > 0 THEN SG =SG+ GG%*N: PRINT "**";SG: RETURN
520 G%(GX,GY AND GM%)=N
530 RETURN